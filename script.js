const burger=document.querySelector(".header__burger-menu"),close=document.querySelector(".header__close"),nav=document.querySelector(".header__nav-mobile");burger.addEventListener("click",(()=>{nav.classList.add("header__nav-mobile--active")})),close.addEventListener("click",(()=>{nav.classList.remove("header__nav-mobile--active")}));const question=document.querySelector(".quiz__right-question"),answers=document.querySelector(".quiz__right-answers"),nextBtn=document.querySelector(".quiz__right-next"),prevBtn=document.querySelector(".quiz__right-prev");let questionIndex=0;const answersTotal={},currentStep=document.querySelector(".quiz__current-step"),totalSteps=document.querySelector(".quiz__total-steps"),quizProgress=document.querySelector(".quiz__least-questions");let giftImage="";const questionsVariants=[{questionTitle:"Какой ваш бюджет на покупку автомобиля?",answers:["до 1 млн","1-2 млн","2-3 Млн","3-4 млн","более 4-х млн"]},{questionTitle:"Какие марки?",answers:["Skoda","Renault","Toyota","Tesla","Subaru","Porshe","Nissan","Ford","Chevrolet","Honda","Mazda","Hyundai","Kia","Volkswagen","Audi","BMW","Mercedes-Benz","Lexus","Jeep","Land Rover","Ferrari","Lamborghini","Maserati","Aston Martin","Jaguar","Volvo","Mini","Mitsubishi","Infiniti"]},{questionTitle:"Пробег",answers:["до 50 тыс","до 100 тыс","до 150 тыс","до 200 тыс"]},{questionTitle:"Трансмиссия",answers:["AT","MT"]},{questionTitle:"Как скоро вы планируете покупку автомобиля?",answers:["в ближайшие 2 недели","в ближайший месяц","в ближайшие 3 месяца","в ближайшие полгода"]},{questionTitle:"Выберите подарок",answers:["./img/gift-1.jpg","./img/gift-2.jpg","./img/gift-3.jpg"],descrs:["Мойка люкс","Набор автомобилиста","Скидка 4 тысячи на услугу автоподбора"]}];function updateNextButtonState(){const e=answers.querySelectorAll('input[type="checkbox"]:checked, input[type="checkbox"]:checked'),t=Array.from(e).filter((e=>e.checked));questionIndex===questionsVariants.length-1?nextBtn.disabled=0===t.length&&!answersTotal[questionsVariants[questionIndex].questionTitle]:nextBtn.disabled=0===t.length,prevBtn.disabled=0===questionIndex}function displayNextQuestion(){const e=questionsVariants[questionIndex];if(!e)return console.log("Ответы:",answersTotal),nextBtn.setAttribute("disabled","true"),void finalInitial();question.textContent=e.questionTitle,answers.innerHTML="";const t=document.querySelector(".quiz__right-answers");if(1===questionIndex){const n=document.createElement("div"),s=document.createElement("div");n.classList.add("fake__select"),s.classList.add("fake__select-preview"),e.answers.forEach(((t,i)=>{const a=`answer_${i+1}`,o=document.createElement("label"),r=document.createElement("input"),c=document.createElement("span"),l=document.querySelector(".quiz__right-answers");c.classList.add("custom-radio"),r.type="checkbox",r.id=a,r.classList.add("quiz__right-answer"),r.value=t,o.appendChild(r),o.appendChild(c),o.appendChild(document.createTextNode(t)),currentStep.textContent=questionIndex+1,quizProgress.textContent=questionsVariants.length-1-questionIndex,r.addEventListener("change",(()=>{if(r.checked)answersTotal[e.questionTitle]?answersTotal[e.questionTitle].push(t):answersTotal[e.questionTitle]=[t];else{const n=answersTotal[e.questionTitle].indexOf(t);n>-1&&answersTotal[e.questionTitle].splice(n,1)}updateNextButtonState()})),s.appendChild(o),s.setAttribute("data-placeholder","Audi"),n.appendChild(o),l.style.gridTemplateColumns=4===questionIndex?"1fr":"repeat(3, 1fr)"})),s.addEventListener("click",(()=>{console.log("click"),n.classList.toggle("fake__select--active"),s.classList.toggle("fake__select-preview--active")})),answers.appendChild(s),answers.appendChild(n);const i=document.createElement("input");i.type="text",i.placeholder="Например BQ9",i.classList.add("quiz__input-answer"),i.addEventListener("input",(t=>{const n=t.target.value,s=[...Array.from(document.querySelectorAll(".quiz__right-answer:checked")).map((e=>e.value)),n];answersTotal[e.questionTitle]=s,updateNextButtonState()}));const a=document.createElement("p");a.textContent="Вы можете выбрать несколько интересующих марок",a.classList.add("quiz__first-par"),answers.appendChild(a);const o=document.createElement("p");o.textContent="Если вы уже определились с конкретной моделью авто, впишите ее сюда:",o.classList.add("quiz__second-par"),answers.appendChild(o),answers.appendChild(i),t.style.flexDirection="column"}else if(questionIndex===questionsVariants.length-1){e.answers.forEach(((t,n)=>{const s=document.createElement("div"),i=document.createElement("img");i.src=t,i.alt=`Answer ${n+1}`,i.setAttribute("data-answer",e.descrs[n]),i.classList.add("quiz__right-img"),s.classList.add("quiz__right-imagewrap");const a=document.createElement("p");a.textContent=e.descrs[n],a.classList.add("quiz__right-descr"),s.appendChild(i),s.appendChild(a),answers.appendChild(s),i.addEventListener("click",(()=>{document.querySelectorAll(".quiz__right-img").forEach((e=>{e.classList.remove("quiz__right-img--active"),giftImage=t})),i.classList.add("quiz__right-img--active"),answersTotal[e.questionTitle]=[e.descrs[n]],updateNextButtonState()}))}));document.querySelector(".quiz__right-gift-descr").style.display="none",t.style.flexDirection="row",t.style.gap="10px"}else e.answers.forEach(((t,n)=>{const s=`answer_${n+1}`,i=document.createElement("label"),a=document.createElement("input"),o=document.createElement("span"),r=document.querySelector(".quiz__right-answers");o.classList.add("custom-radio"),a.type="checkbox",a.id=s,a.name="answer",a.classList.add("quiz__right-answer"),a.value=t,i.appendChild(a),i.appendChild(o),i.appendChild(document.createTextNode(t)),currentStep.textContent=questionIndex+1,quizProgress.textContent=questionsVariants.length-1-questionIndex,a.addEventListener("change",(()=>{if(a.checked)answersTotal[e.questionTitle]?answersTotal[e.questionTitle].push(t):answersTotal[e.questionTitle]=[t];else{const n=answersTotal[e.questionTitle].indexOf(t);n>-1&&answersTotal[e.questionTitle].splice(n,1)}updateNextButtonState()})),answers.appendChild(i),r.style.gridTemplateColumns=4===questionIndex?"1fr":"repeat(3, 1fr)"}));updateNextButtonState()}function progressBar(){const e=questionIndex,t=document.querySelector(".quiz__right-progress").offsetWidth,n=document.querySelector(".quiz__right-filler"),s=t/5;e===questionsVariants.length?n.style.width=`${t}px`:n.style.width=s*e+"px"}function outerClick(e){const t=document.querySelector(".fake__select-preview"),n=document.querySelector(".fake__select");if(t&&n&&e.target!==t&&!t.contains(e.target)&&e.target!==n&&!n.contains(e.target)){n.classList.remove("fake__select--active"),t.classList.remove("fake__select-preview--active");const e=document.querySelector('.quiz__right-answers input[type="checkbox"]:checked, input[type="checkbox"]:checked');if(e){const n=e.value;t.setAttribute("data-placeholder",n)}}}function finalInitial(){const e=document.querySelector(".quiz__content-quiz"),t=document.querySelector(".quiz__content-final"),n=document.querySelector(".quiz__content-gift-preview").querySelector("img");e.style.display="none",t.style.display="block";const s=document.querySelector(".quiz__content");s.style.backgroundImage='url("./img/contacts-bg.jpg")',s.style.backgroundSize="cover",s.style.backgroundPosition="center",s.style.backgroundRepeat="no-repeat";const i=document.querySelector(".specify__gift"),a=answersTotal[questionsVariants[5].questionTitle],o=a?a[a.length-1]:"";i.textContent=o,n.src=giftImage;window.screen.width<525&&(s.style.backgroundImage='url("./img/contacts-mobile-bg.jpg")')}totalSteps.textContent=questionsVariants.length-1,nextBtn.addEventListener("click",(()=>{questionIndex++,displayNextQuestion(),progressBar()})),prevBtn.addEventListener("click",(()=>{questionIndex>0&&(questionIndex--,displayNextQuestion(),progressBar())})),displayNextQuestion(),progressBar(),document.addEventListener("click",outerClick);const sendBtn=document.querySelector(".quiz__content-send");async function sendObj(e){try{const t=await fetch("https://futug-mailer.vercel.app/api/send",{method:"POST",body:JSON.stringify(e),headers:{"Content-type":"application/json; charset=UTF-8"}});if(t.ok){const e=document.querySelector(".popup"),t=document.querySelector(".popup__content");e.classList.add("popup--active"),t.classList.add("popup__content--active");document.querySelector(".popup__content-btn").addEventListener("click",(()=>{e.classList.remove("popup--active"),t.classList.remove("popup__content--active"),location.reload()})),console.log("Данные успешно отправлены.")}else console.error("Ошибка при отправке данных. Статус:",t.status)}catch(e){console.error("Произошла ошибка:",e)}}sendBtn.addEventListener("click",(()=>{const e=document.querySelector(".quiz__content-final-input").querySelector("input").value,t={email:"savazkitim@gmail.com",present:answersTotal["Выберите подарок"],time:answersTotal["Как скоро вы планируете покупку автомобиля?"],mark:answersTotal["Какие марки?"],amount:answersTotal["Какой ваш бюджет на покупку автомобиля?"],mileAge:answersTotal["Пробег"],phone:e,transmition:answersTotal["Трансмиссия"]};console.log(t),sendObj(t)}));const phone=document.querySelector(".quiz__content-phone");phone.addEventListener("click",(()=>{new IMask(phone,{mask:"+7(000)000-00-00",lazy:!1})}));